{% set imageSize = size ?? 'large' %}
{% set imageAlignment = alignment ?? 'center' %}
{% set showCaption = caption is defined and caption is not empty %}

<figure class="my-8 {{ 'text-' ~ imageAlignment }}">
    {% if image %}
        <div class="inline-block bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden transform hover:-translate-y-1
                    {% if imageSize == 'small' %}max-w-xs
                    {% elseif imageSize == 'medium' %}max-w-2xl
                    {% elseif imageSize == 'large' %}max-w-4xl
                    {% else %}max-w-full{% endif %}">

            <div class="relative overflow-hidden
                        {% if imageSize == 'small' %}aspect-square
                        {% elseif imageSize == 'medium' %}aspect-[4/3]
                        {% else %}aspect-video{% endif %}">
                <img src="{{ image.getUrl(imageSize) }}"
                     alt="{{ image.title ?? caption ?? '' }}"
                     class="w-full h-full object-cover hover:scale-105 transition-transform duration-500"
                        {% if image.width and image.height %}
                            width="{{ image.getWidth(imageSize) }}"
                            height="{{ image.getHeight(imageSize) }}"
                        {% endif %} />

                <!-- Overlay gradient for better caption readability -->
                {% if showCaption %}
                    <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 hover:opacity-100 transition-opacity duration-300"></div>
                {% endif %}
            </div>

            {% if showCaption %}
                <figcaption class="p-4 bg-gradient-to-r from-sand-50 to-coral-50 border-t-2 border-coral-200">
                    <p class="text-ocean-700 font-medium text-center leading-relaxed">
                        {{ caption }}
                    </p>
                </figcaption>
            {% endif %}
        </div>
    {% endif %}
</figure>